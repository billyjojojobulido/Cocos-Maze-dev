window.__require=function t(e,o,i){function r(s,c){if(!o[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var _="function"==typeof __require&&__require;if(!c&&_)return _(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var p=o[s]={exports:{}};e[s][0].call(p.exports,function(t){return r(e[s][1][t]||t)},p,p.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({Brick:[function(t,e,o){"use strict";cc._RF.push(e,"28681kGzrpE04yfnKsRIoZH","Brick");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.unuse=function(){this.node.active=!1},e.prototype.reuse=function(){this.node.active=!0},n([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],GameConstant:[function(t,e,o){"use strict";cc._RF.push(e,"c33b1JJRoFJzpm+ErRNs1qO","GameConstant"),Object.defineProperty(o,"__esModule",{value:!0}),o.MAZE_MOVE_STEP=o.MAZE_N=o.MAZE_M=o.BRICK_WIDTH=o.BRICK_HEIGHT=o.TILE_TYPE=void 0,function(t){t[t.TILE_ROAD=0]="TILE_ROAD",t[t.TILE_WALL=1]="TILE_WALL",t[t.TILE_STAR=2]="TILE_STAR"}(o.TILE_TYPE||(o.TILE_TYPE={})),o.MAZE_MOVE_STEP=30,o.BRICK_WIDTH=30,o.BRICK_HEIGHT=30,o.MAZE_N=19,o.MAZE_M=19,cc._RF.pop()},{}],MazeBuilder:[function(t,e,o){"use strict";cc._RF.push(e,"41188/3EItNv69N3SZaxvmX","MazeBuilder"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./GameConstant"),r=t("./Queue"),n=[[0,1],[0,-1],[1,0],[-1,0]];function s(){for(var t=new Array(i.MAZE_M),e=0;e<i.MAZE_M;e++)t[e]=new Array(i.MAZE_N).fill(i.TILE_TYPE.TILE_WALL);return t}function c(t,e){return t>0&&t<i.MAZE_M&&e>0&&e<i.MAZE_N}var a=function(){function t(){this._visited=void 0,this._visited=new Array(i.MAZE_M);for(var t=0;t<i.MAZE_M;t++)this._visited[t]=new Array(i.MAZE_N).fill(!1)}return t.prototype._clearMaze=function(t){for(var e=0;e<i.MAZE_M;e++)for(var o=0;o<i.MAZE_N;o++)t[e][o]=i.TILE_TYPE.TILE_WALL,this._visited[e][o]=!1},t.prototype.buildMaze=function(){var t=s();return this._generalizePath(t,!1),t},t.prototype._generalizePath=function(t,e){var o=new r.default;e&&this._clearMaze(t),o.enqueue({x:1,y:1}),t[1][1]=i.TILE_TYPE.TILE_ROAD,this._visited[1][1]=!0;for(var s=void 0;!o.isEmpty();){var a=o.randomDequeue();s=a;for(var _=0;_<n.length;_++){var p=a.x+2*n[_][0],u=a.y+2*n[_][1];if(c(p,u)&&!this._visited[p][u]){o.enqueue({x:p,y:u}),this._visited[p][u]=!0,p<i.MAZE_M-1&&u<=i.MAZE_N-1?t[p][u]=i.TILE_TYPE.TILE_ROAD:console.log(a.x,a.y,n[_]);var h={x:a.x+n[_][0],y:a.y+n[_][1]};c(h.x,h.y)&&(this._visited[h.x][h.y]=!0,t[h.x][h.y]=i.TILE_TYPE.TILE_ROAD)}}}t[s.x][s.y]=i.TILE_TYPE.TILE_STAR},t.prototype.rebuildMaze=function(t){this._generalizePath(t,!0)},t}();o.default=a,cc._RF.pop()},{"./GameConstant":"GameConstant","./Queue":"Queue"}],Maze:[function(t,e,o){"use strict";cc._RF.push(e,"e8e96QsNVJBoLvQ7HeKfBVe","Maze");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,_=t("./helper/GameConstant"),p=t("./helper/MazeBuilder"),u=t("./Player"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.brick=void 0,e.player=void 0,e.star=void 0,e.timeDisplay=void 0,e.progressBar=void 0,e.levelLabel=void 0,e.gameOverLabel=void 0,e.startBtn=void 0,e.pauseBtn=void 0,e.maxMoveTime=0,e._startX=0,e._startY=0,e._mazeArray=void 0,e._timer=0,e._isPaused=!0,e._level=0,e._builder=void 0,e._brickPool=void 0,e}return r(e,t),e.prototype.onLoad=function(){cc.director.getCollisionManager().enabled=!0,this._brickPool=new cc.NodePool,this._builder=new p.default,this._mazeArray=this._builder.buildMaze(),this._displayMaze(),this._startX=_.BRICK_WIDTH,this._startY=-_.BRICK_HEIGHT,this._timer=0,this.timeDisplay.string="Time: "+this.maxMoveTime+"s",this.progressBar.progress=1,this._initPlayer()},e.prototype._initPlayer=function(){this.player.node.setPosition(cc.v2(this._startX,this._startY)),this.player.getComponent(u.default).init(this)},e.prototype._resetLevel=function(){this._level=0,this.levelLabel.string="Level: "+this._level},e.prototype.startPlaying=function(){this.gameOverLabel.node.active&&(this.gameOverLabel.node.active=!1,this._resetLevel(),this._rebuildMaze(),this._displayMaze()),this.player.node.setPosition(cc.v2(this._startX,this._startY)),this._timer=0,this.timeDisplay.string="Time: "+this.maxMoveTime+"s",this.progressBar.progress=1,this.startBtn.node.active=!1,this._isPaused=!1,this.pauseBtn.node.active=!0},e.prototype.onPauseClick=function(){this._isPaused?this._resumeGame():this._pauseGame()},e.prototype._pauseGame=function(){this._isPaused=!0,this._changeBtnName("Resume")},e.prototype._changeBtnName=function(t){this.pauseBtn.node.getChildByName("Background").getChildByName("Label").getComponent(cc.Label).string=t},e.prototype._resumeGame=function(){this._isPaused=!1,this._changeBtnName("Pause")},e.prototype._displayMaze=function(){for(var t=0;t<_.MAZE_M;t++)for(var e=0;e<_.MAZE_N;e++)switch(this._mazeArray[t][e]){case _.TILE_TYPE.TILE_WALL:this._forgeBrick(e*_.BRICK_WIDTH,-t*_.BRICK_HEIGHT);break;case _.TILE_TYPE.TILE_STAR:this.star.node.setPosition(e*_.BRICK_WIDTH,-t*_.BRICK_HEIGHT)}},e.prototype._forgeBrick=function(t,e){var o=void 0;this._brickPool.size()>0?o=this._brickPool.get():((o=cc.instantiate(this.brick)).width=_.BRICK_WIDTH,o.height=_.BRICK_HEIGHT),this.node.addChild(o),o.x=t,o.y=e},e.prototype._reuseBrick=function(t){this._brickPool.put(t)},e.prototype._recycleAllBricks=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--)"Brick"===t[e].name&&this._reuseBrick(t[e])},e.prototype.playerCanMove=function(){return!this._isPaused},e.prototype.isWall=function(t,e){return this._mazeArray[e][t]===_.TILE_TYPE.TILE_WALL},e.prototype._rebuildMaze=function(){this._recycleAllBricks(),this._builder.rebuildMaze(this._mazeArray)},e.prototype.levelUp=function(){this._timer=0,this._level+=1,this.levelLabel.string="Level: "+this._level,this._rebuildMaze(),this._displayMaze(),this.player.node.setPosition(cc.v2(this._startX,this._startY))},e.prototype._gameOver=function(){this._isPaused=!0,this.gameOverLabel.node.active=!0,this.startBtn.node.active=!0},e.prototype.update=function(t){this._isPaused||(this._timer+=t,this._timer>=this.maxMoveTime?this._gameOver():(this.timeDisplay.string="Time: "+Math.floor(this.maxMoveTime-this._timer)+"s",this.progressBar.progress=Math.floor(this.maxMoveTime-this._timer)/this.maxMoveTime))},n([a(cc.Prefab)],e.prototype,"brick",void 0),n([a(cc.Sprite)],e.prototype,"player",void 0),n([a(cc.Collider)],e.prototype,"star",void 0),n([a(cc.Label)],e.prototype,"timeDisplay",void 0),n([a(cc.ProgressBar)],e.prototype,"progressBar",void 0),n([a(cc.Label)],e.prototype,"levelLabel",void 0),n([a(cc.Label)],e.prototype,"gameOverLabel",void 0),n([a(cc.Button)],e.prototype,"startBtn",void 0),n([a(cc.Button)],e.prototype,"pauseBtn",void 0),n([a],e.prototype,"maxMoveTime",void 0),n([c],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./Player":"Player","./helper/GameConstant":"GameConstant","./helper/MazeBuilder":"MazeBuilder"}],Player:[function(t,e,o){"use strict";cc._RF.push(e,"794745eAnZCT5d2uET2mYEi","Player");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s,c=cc._decorator,a=c.ccclass,_=c.property,p=t("./helper/GameConstant");(function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.STILL=4]="STILL"})(s||(s={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stepDuration=0,e._isMoving=!1,e._isPressing=!1,e._game=void 0,e}return r(e,t),e.prototype.onLoad=function(){this._setInputListener()},e.prototype.init=function(t){this._game=t},e.prototype.onCollisionEnter=function(t,e){var o=this;console.log("THERE IS A COLLISION : ("+t.node.x+", "+t.node.y+") ,  ("+e.node.x+", "+e.node.y+")"),setTimeout(function(){o._game.levelUp(),console.log("LEVEL UP ALREADY")},1e3*this.stepDuration)},e.prototype.onDestroy=function(){this._closeInputListener()},e.prototype._canMove=function(t,e){return!this._game.isWall(this.node.x/p.BRICK_WIDTH+t,this.node.y/-p.BRICK_HEIGHT+e)},e.prototype._setInputListener=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this._onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this._onKeyUp,this)},e.prototype._closeInputListener=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP)},e.prototype._onKeyDown=function(t){if(!this._isPressing&&!this._isMoving&&this._game.playerCanMove())switch(t.keyCode){case cc.macro.KEY.left:this._isPressing=!0,this._moveLeft();break;case cc.macro.KEY.right:this._isPressing=!0,this._moveRight();break;case cc.macro.KEY.up:this._isPressing=!0,this._moveUp();break;case cc.macro.KEY.down:this._isPressing=!0,this._moveDown()}},e.prototype._moveLeft=function(){this._canMove(-1,0)&&this._startMoving(s.LEFT)},e.prototype._moveRight=function(){this._canMove(1,0)&&this._startMoving(s.RIGHT)},e.prototype._moveUp=function(){this._canMove(0,-1)&&this._startMoving(s.UP)},e.prototype._moveDown=function(){this._canMove(0,1)&&this._startMoving(s.DOWN)},e.prototype._onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.left:case cc.macro.KEY.right:case cc.macro.KEY.up:case cc.macro.KEY.down:this._isPressing=!1}},e.prototype._startMoving=function(t){var e,o=this;this._isMoving=!0;var i=null===(e=this._getMovement(t))||void 0===e?void 0:e.call(function(){o._isMoving=!1});cc.tween(this.node).then(i).start()},e.prototype._getMovement=function(t){switch(t){case s.DOWN:return cc.tween(this.node).by(this.stepDuration,{y:-p.MAZE_MOVE_STEP},{easing:"sineOut"});case s.UP:return cc.tween(this.node).by(this.stepDuration,{y:p.MAZE_MOVE_STEP},{easing:"sineOut"});case s.LEFT:return cc.tween(this.node).by(this.stepDuration,{x:-p.MAZE_MOVE_STEP},{easing:"sineOut"});case s.RIGHT:return cc.tween(this.node).by(this.stepDuration,{x:p.MAZE_MOVE_STEP},{easing:"sineOut"});default:return}},n([_],e.prototype,"stepDuration",void 0),n([a],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./helper/GameConstant":"GameConstant"}],Point:[function(t,e,o){"use strict";cc._RF.push(e,"7f6beBwbpNCb5JXoCuH5k+9","Point"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],Queue:[function(t,e,o){"use strict";cc._RF.push(e,"7ab09ymYqZBjqhgeyDMhk87","Queue"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this._nodes=[]}return t.prototype.enqueue=function(t){this._nodes.push(t)},t.prototype.dequeue=function(){return this._nodes.shift()},t.prototype.front=function(){return this._nodes[0]},t.prototype.isEmpty=function(){return 0===this._nodes.length},t.prototype.size=function(){return this._nodes.length},t.prototype.randomDequeue=function(){if(0!==this._nodes.length){var t=Math.floor(Math.random()*this._nodes.length),e=this._nodes[t];return this._nodes[t]=this._nodes[0],this._nodes.shift(),e}},t}();o.default=i,cc._RF.pop()},{}]},{},["Brick","Maze","Player","GameConstant","MazeBuilder","Point","Queue"]);